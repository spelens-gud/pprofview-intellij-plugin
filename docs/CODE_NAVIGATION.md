# 代码导航功能

## 功能概述

在 pprof 可视化界面的"详细数据"标签页中，点击函数名可以直接跳转到源代码位置，并高亮显示性能热点代码行。

## 使用方法

1. **打开 pprof 文件**
   - 在项目视图中右键点击 `.pprof` 文件
   - 选择"使用 go tool pprof 可视化"

2. **查看详细数据**
   - 在弹出的工具窗口中，切换到"详细数据"标签页
   - 表格中会显示所有函数的性能数据

3. **跳转到代码**
   - 点击表格中的函数名（显示为蓝色链接）
   - 插件会自动：
     - 使用 `go tool pprof -list` 获取函数的源代码信息
     - 在编辑器中打开对应的源文件
     - 滚动到函数定义位置
     - 高亮显示性能热点代码行（黄色背景）

## 技术实现

### 核心组件

1. **PprofCodeNavigationService**
   - 负责执行 `go tool pprof -list` 命令
   - 解析输出，提取文件路径和行号信息
   - 在编辑器中打开文件并添加高亮

2. **PprofChartPanel**
   - 在表格中添加鼠标点击监听器
   - 将函数名列显示为可点击的链接样式
   - 调用导航服务进行跳转

3. **PprofOutputToolWindow**
   - 管理 pprof 文件的引用
   - 将文件信息传递给图表面板

### 代码高亮

使用 IntelliJ Platform 的 MarkupModel API 实现代码高亮：

- 黄色背景：标识性能热点代码行
- 自动滚动：将目标行滚动到编辑器中央
- 多行高亮：支持高亮函数内的多个热点行

## 示例

假设有以下 pprof 输出：

```
flat  flat%   sum%        cum   cum%
10.50s 52.50% 52.50%     10.50s 52.50%  main.fibonacci
```

点击 `main.fibonacci` 后：

1. 执行命令：`go tool pprof -list=main.fibonacci profile.pprof`
2. 解析输出，找到文件路径：`/path/to/main.go`
3. 打开文件并跳转到第 10 行（函数定义）
4. 高亮第 12 行（性能热点）

## 注意事项

- 需要安装 Go 工具链（`go tool pprof` 命令）
- 源代码文件必须存在于本地文件系统
- 函数名必须与源代码中的定义完全匹配
- 如果无法找到源代码，不会显示错误，只是不会跳转

## 未来改进

- [ ] 支持远程源代码（通过 Go modules）
- [ ] 添加错误提示通知
- [ ] 支持更多的代码高亮样式
- [ ] 添加快捷键支持
- [ ] 支持从火焰图直接跳转
